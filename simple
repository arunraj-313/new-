[HttpPost]
public ActionResult RegisterPopup(UserModel user)
{
    if (!ModelState.IsValid)
    {
        return PartialView("RegisterPopup", user);
    }

    try
    {
        using (SqlConnection con = new SqlConnection(connString))
        {
            string query = @"INSERT INTO Users 
                            (FullName, Email, Gender, PhoneNo, Address, IDProofType, IDProofNumber, Occupation, PasswordHash, Role)
                             VALUES
                            (@FullName, @Email, @Gender, @PhoneNo, @Address, @IDProofType, @IDProofNumber, @Occupation, @PasswordHash, 'User')";

            SqlCommand cmd = new SqlCommand(query, con);

            cmd.Parameters.AddWithValue("@FullName", user.FullName);
            cmd.Parameters.AddWithValue("@Email", user.Email);
            cmd.Parameters.AddWithValue("@Gender", user.Gender ?? "");
            cmd.Parameters.AddWithValue("@PhoneNo", user.PhoneNo);
            cmd.Parameters.AddWithValue("@Address", user.Address ?? "");
            cmd.Parameters.AddWithValue("@IDProofType", user.IDProofType ?? "");
            cmd.Parameters.AddWithValue("@IDProofNumber", user.IDProofNumber ?? "");
            cmd.Parameters.AddWithValue("@Occupation", user.Occupation ?? "");
            cmd.Parameters.AddWithValue("@PasswordHash", user.Password);

            con.Open();
            cmd.ExecuteNonQuery();
        }

        return Json(new { success = true, message = "Registration Successful!" });
    }
    catch (Exception ex)
    {
        return Json(new { success = false, message = "Error: " + ex.Message });
    }
}
